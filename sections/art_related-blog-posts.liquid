{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'next_art_related-blog-posts.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign articles_to_display = 4
  assign separator = '_'

  for tag in article.tags
    unless tag contains separator
      assign custom_tag = tag
    endunless
  endfor
-%}

{%- for blogpost in blogs['slam-stories'].articles -%}
  {% if blogpost.tags contains custom_tag and blogpost.title != article.title %}
    <div class="related-blog-posts isolate gradient">
      <div class="carousel_header title-wrapper title-wrapper--no-top-margin page-width">
        {%- if section.settings.subtitle != blank -%}
          <h3
            class="carousel_subtitle{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
          ></h3>
        {%- endif -%}
        {%- if section.settings.title != blank -%}
          <h2 class="carousel_title h1 italic{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
            Slam Stories
          </h2>
        {%- endif -%}
      </div>

      <div class="articles-container page-width{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        <ul
          id="Slider-{{ section.id }}"
          class="grid grid--4-col-desktop grid--2-col-tablet-down slider slider--desktop slider--tablet grid--peek"
          role="list"
          aria-label="{{ 'general.slider.name' | t }}"
        >
          {% assign articles_counter = 1 %}
          {%- for blogpost in blogs['slam-stories'].articles -%}
            {% if blogpost.tags contains custom_tag and articles_counter <= articles_to_display %}
              {% assign articles_counter = articles_counter | plus: 1 %}
              {% unless blogpost.title == article.title %}
                <li
                  id="Slide-{{ section.id }}-{{ forloop.index }}"
                  class="related-blogpost grid__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                  {% if settings.animations_reveal_on_scroll %}
                    data-cascade
                    style="--animation-order: {{ forloop.index }};"
                  {% endif %}
                >
                  {%- render 'article-card',
                    article: blogpost,
                    media_aspect_ratio: blogpost.image.aspect_ratio,
                    show_image: true,
                    is_carousel: false,
                    is_related: true
                  -%}
                </li>
              {% endunless %}
            {% endif %}
          {%- endfor -%}
        </ul>
      </div>
    </div>
    {% break %}
  {% endif %}
{% endfor %}

{% schema %}
{
  "name": "ART - Articoli correlati",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "Titoletto",
      "default": "Stories"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Titolo sezione",
      "default": "Titolo Stories"
    }
  ],
  "presets": [
    {
      "name": "ART - Articoli correlati",
      "category": "Custom"
    }
  ]
}
{% endschema %}
